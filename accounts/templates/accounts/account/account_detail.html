{% extends 'base_wide.html' %}
{% load views contests %}

{% block title %}
Профиль
{% endblock title %}

{% block breadcrumbs %}
{% breadcrumb "Главная" 'contests:index' %}
{% breadcrumb "Пользователи" 'accounts:account-list' %}
{% breadcrumb account %}
{% endblock breadcrumbs %}

{% block content %}
<legend>
    {{ account }}
    {% if account.user_id == request.user.id %}
    <a href="{% url 'password-change' %}" class="text-secondary text-decoration-none pull-right" data-toggle="tooltip" data-placement="top" title="Изменить пароль" style="position: relative; top: -0.03rem;"><i class="fa fa-lock fa-fw"></i></a>
    {% endif %}
    {% if perms.accounts.change_account or perms.auth.change_user_email or account.user_id == request.user.id %}
    <a href="{% url 'accounts:account-update' account.user.id %}" class="text-primary text-decoration-none pull-right" data-toggle="tooltip" data-placement="left" title="Редактировать профиль"><i class="fa fa-edit fa-fw"></i></a>
    {% endif %}
</legend>
<div class="row my-3">
    <div class="col-3">
        {% include 'accounts/account/account_card.html' with image=True %}
    </div>
    <div class="col-9">
        <table class="table table-borderless table-sm">
            <tr><td class="text-right" style="width: 30%;">e-mail</td><td>{% if account.email %}<a href="mailto:{{ account.email }}">{{ account.email }}</a>{% elif perms.auth.change_account or perms.auth.change_user_email or account.user_id == request.user.id %}<a href="{% url 'accounts:account-update' account.user_id %}" class="text-danger" >укажите e-mail</a>{% else %}-{% endif %}</td></tr>
            <tr><td class="text-right" style="width: 30%;">Факультет</td><td>{{ account.faculty }}</td></tr>
            <tr><td class="text-right" style="width: 30%;">Группа</td><td>{% for group in account.user.groups.all %} <span class="badge badge-secondary">{{ group }}</span>{% endfor %}</td></tr>
            <tr><td class="text-right" style="width: 30%;">Тип учетной записи</td><td>{{ account.get_type_display }}</td></tr>
            {% if account.is_student %}
            <tr><td class="text-right" style="width: 30%;">Уровень</td><td>{{ account.get_level_display }}</td></tr>
            <tr><td class="text-right" style="width: 30%;">Год поступления</td><td>{{ account.admission_year }}</td></tr>
            <tr><td class="text-right" style="width: 30%;">Обучается</td><td>{{ account.enrolled|yesno:'да,нет' }}</td></tr>
            <tr><td class="text-right" style="width: 30%;">Закончил обучение</td><td>{{ account.graduated|yesno:'да,нет' }}</td></tr>
            {% endif %}
            {% if perms.accounts.change_account %}
            <tr><td class="text-right" style="width: 30%;">Логин</td><td>{{ account.username }}</td></tr>
            <tr><td class="text-right" style="width: 30%;">Последний вход</td><td>{{ account.last_login|date:'d E Y, H:i' }}</td></tr>
            <tr><td class="text-right" style="width: 30%;">Дата регистрации</td><td>{{ account.date_joined|date:'d E Y' }}</td></tr>
            {% endif %}
        </table>
    </div>
</div>
{% if account.is_student %}
<legend>Активность</legend>
<div class="table-responsive my-3">
    <table class="table table-sm table-hover">
        <tbody>
            <tr>
                <td style="vertical-align: middle;">Количество решенных задач</td>
                <td class="text-center" style="vertical-align: middle; width: 4%;">
                    <span class="numtus status-{{ account.solved_problems_count|colorize_activity_count }}">{{ account.solved_problems_count }}</span>
                </td>
            </tr>
            <tr title="Учитывает количество посылок для решения задачи">
                <td style="vertical-align: middle;">Точность</td>
                <td class="text-center" style="vertical-align: middle; width: 4%;">
                    <span class="numtus status-{{ account.submissions_score|colorize_submissions_score }}">{{ account.submissions_score }}%</span>
                </td>
            </tr>
            <tr>
                <td style="vertical-align: middle;">Количество комментариев</td>
                <td class="text-center" style="vertical-align: middle; width: 4%;">
                    <span class="numtus status-{{ comments_count|colorize_activity_count }}">{{ comments_count }}</span>
                </td>
            </tr>
            <tr>
                <td style="vertical-align: middle;">Количество вопросов</td>
                <td class="text-center" style="vertical-align: middle; width: 4%;">
                    <span class="numtus status-{{ questions_count|colorize_activity_count }}">{{ questions_count }}</span>
                </td>
            </tr>
            <tr>
                <td style="vertical-align: middle;">Количество сообщений об ошибках</td>
                <td class="text-center" style="vertical-align: middle; width: 4%;">
                    <span class="numtus status-{{ reports_count|colorize_activity_count }}">{{ reports_count }}</span>
                </td>
            </tr>
        </tbody>
    </table>
</div>

{% if perms.contests.view_assignment_table or account.user_id == request.user.id %}
{% if credits %}
<legend>
    Результаты
    {% if account.is_student %}
        {% if perms.accounts.change_account or perms.auth.change_user_email or account.user_id == request.user.id %}
        <a href="{% if account.user_id == request.user.id %} {% url 'contests:assignment-list' %} {% else %} {% url 'accounts:account-assignment-list' account.user_id %} {% endif %}" class="text-secondary text-decoration-none pull-right" data-toggle="tooltip" data-placement="left" title="Задания" style="position: relative; top: -0.08rem;"><i class="fa fa-list-ol fa-fw"></i></a>
        {% endif %}
    {% endif %}
</legend>
{% include 'accounts/account/account_results.html' %}
{% render_progress account.score "Общая успеваемость" %}
{% endif %}
{% endif %}
{% endif %}
{% endblock content %}
