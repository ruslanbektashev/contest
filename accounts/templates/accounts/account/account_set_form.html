{% extends 'base_wide.html' %}
{% load views forms tutorial %}

{% block title %}
Регистрация
{% endblock title %}

{% block breadcrumbs %}
{% breadcrumb "Главная" 'contests:index' %}
{% breadcrumb "Пользователи" 'accounts:account-list' %}
{% breadcrumb "Регистрация" %}
{% endblock breadcrumbs %}

{% block content %}
<legend>
    <div class="d-flex justify-content-between">
        <span class="text-truncate">Регистрация</span>
        <span class="text-muted">{{ faculty }}</span>
    </div>
</legend>
<form action="" method="post">
    {% csrf_token %}
    {% render_form_errors form %}
    {% with WIDGET_RENDER_TO_TEMPLATE="field.html" WIDGET_ERROR_CLASS="is-invalid" %}
    <div id="field_faculty">
    {% render_field form.faculty class+="form-control selectpicker" %}
    </div>
    <div id="field_level">
    {% render_field form.level class+="form-control selectpicker" %}
    </div>
    <div id="field_type">
    {% render_field form.type class+="form-control selectpicker" %}
    </div>
    <div id="field_admission_year">
    {% render_field form.admission_year class+="form-control selectpicker" %}
    </div>
    <div id="field_names">
    {% render_field form.names class+="form-control" placeholder="в формате: Фамилия Имя Отчество" %}
    </div>
    {% endwith %}
    <div id="form_submit_button">
    {% render_submit_button value="Зарегистрировать" %}
    </div>
</form>
{% endblock content %}

{% block javascript %}
<script>
driver.defineSteps([
    {% if request.user.account.is_moderator or request.user.is_superuser %}
    {% if not request|have_passed_step:'field_faculty' %}
    {
        view: '{% tutorial_step_view request %}',
        step: 'field_faculty',
        element: '#field_faculty',
        popover: {
            title: " ",
            description: "Выберите факультет добавляемых пользователей.<br>" +
                "Доступны факультеты &laquo;ПМиИ&raquo;, &laquo;Психология&raquo;, &laquo;Филология&raquo; и &laquo;РиСО&raquo;.<br>" +
                "По умолчанию выбран Ваш факультет.",
            position: 'bottom-right',
            className: 'driver-popover-md'
        }
    },
    {% endif %}
    {% if not request|have_passed_step:'field_level' %}
    {
        view: '{% tutorial_step_view request %}',
        step: 'field_level',
        element: '#field_level',
        popover: {
            title: " ",
            description: "Выберите уровень добавляемых студентов. Если Вы добавляете преподавателей или модераторов, то пропустите это поле.<br>" +
                "Уровни соответствуют семестру обучения студентов.<br>" +
                "По умолчанию выбран 1 курс, I семестр.",
            position: 'bottom-right',
            className: 'driver-popover-md'
        }
    },
    {% endif %}
    {% if not request|have_passed_step:'field_type' %}
    {
        view: '{% tutorial_step_view request %}',
        step: 'field_type',
        element: '#field_type',
        popover: {
            title: " ",
            description: "Выберите тип добавляемых пользователей.<br>" +
                "Напомним, что:<br>" +
                "<span class='text-primary'>Студенты</span> имеют доступ к просмотру курсов факультета, на котором они обучаются и могут отправлять решения к задачам по заданиям преподавателей.<br>" +
                "<span class='text-success'>Преподаватели</span> могут вносить изменения в свои курсы, назначать задания студентам своих курсов и осуществлять контроль успеваемости.<br>" +
                "<span class='text-secondary'>Модераторы</span> помогают преподавателям и студентам в процессе обучения: управляют учетными записями пользователей, обновляют расписание занятий, публикуют объявления деканатов своих факультетов.<br>" +
                "По умолчанию выбран тип студент.",
            position: 'bottom-right',
            className: 'driver-popover-md'
        }
    },
    {% endif %}
    {% if not request|have_passed_step:'field_admission_year' %}
    {
        view: '{% tutorial_step_view request %}',
        step: 'field_admission_year',
        element: '#field_admission_year',
        popover: {
            title: " ",
            description: "Выберите год поступления добавляемых студентов. Если Вы добавляете преподавателей или модераторов, то пропустите это поле.<br>" +
                "По умолчанию выбран текущий год.",
            position: 'bottom-right',
            className: 'driver-popover-md'
        }
    },
    {% endif %}
    {% if not request|have_passed_step:'field_names' %}
    {
        view: '{% tutorial_step_view request %}',
        step: 'field_names',
        element: '#field_names',
        popover: {
            title: " ",
            description: "Введите Ф.И.О. добавляемых пользователей так, что на каждой новой строке располагается Фамилия Имя Отчество пользователя, например:<br>" +
                "Иванов Иван Иванович<br>" +
                "Александров Александр Александрович<br>",
            position: 'top',
            className: 'driver-popover-md'
        }
    },
    {% endif %}
    {% if not request|have_passed_step:'form_submit_button' %}
    {
        view: '{% tutorial_step_view request %}',
        step: 'form_submit_button',
        element: '#form_submit_button',
        popover: {
            title: " ",
            description: "Когда заполните необходимые поля, нажмите на кнопку &laquo;Сохранить&raquo;.",
            position: 'top',
            className: 'driver-popover-md'
        }
    },
    {% endif %}
    {% endif %}
]);
</script>
{% endblock %}
