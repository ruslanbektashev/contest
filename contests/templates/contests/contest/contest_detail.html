{% extends 'base.html' %}
{% load views contests markdown static %}

{% block title %}
Раздел
{% endblock title %}

{% block breadcrumbs %}
{% breadcrumb "Главная" 'contests:index' %}
{% breadcrumb contest.course contest.course %}
{% breadcrumb contest %}
{% endblock breadcrumbs %}

{% block content %}
<legend>{{ contest }}</legend>
<ul class="nav nav-tabs mb-3" role="tablist">
    <li class="nav-item">
        <a aria-controls="description" aria-selected="{% if not tab or tab == 'description' %}true{% else %}false{% endif %}"
           class="nav-link {% if not tab or tab == 'description' %}active{% endif %}" data-toggle="tab"
           href="#description" id="description-tab" role="tab">Описание</a>
    </li>
    <li class="nav-item">
        <a aria-controls="problems" aria-selected="{% if tab == 'problems' %}true{% else %}false{% endif %}"
           class="nav-link {% if tab == 'problems' %}active{% endif %}" data-toggle="tab" href="#problems"
           id="problems-tab" role="tab">Задачи</a>
    </li>
    <li class="nav-item">
        {% with contest.comment_set.actual.count as comments_count %}
{#        {% get_unread_comments_number comments_count request.user.account.user_id 'contest' contest.id as unread_comments_count %}#}
        <a class="nav-link" href="{% url 'contests:contest-discussion' contest.id %}" id="discussion-tab" role="tab">
            Обсуждение{% if comments_count > 0 %} <span class="badge badge-pill badge-secondary align-middle">{{ comments_count }}</span>{% endif %}
        </a>
        {% endwith %}
    </li>
    <li class="nav-item">
        <a aria-controls="testsuites" aria-selected="{% if tab == 'testsuites' %}true{% else %}false{% endif %}"
           class="nav-link {% if tab == '' %}active{% endif %}" data-toggle="tab" href="#testsuites"
           id="testsuites-tab" role="tab">Тесты</a>
    </li>
</ul>
<div class="tab-content">
    <div aria-labelledby="description-tab" class="tab-pane fade {% if not tab or tab == 'description' %}show active{% endif %}" id="description" role="tabpanel">
        <p>{{ contest.description|markdown|safe }}</p>
        {% render_attachment_list contest %}
    </div>
    <div aria-labelledby="problems-tab" class="tab-pane fade {% if tab == 'problems' %}show active{% endif %}" id="problems" role="tabpanel">
        {% render_list contest.problem_set.all %}
    </div>
    <div aria-labelledby="testsuites-tab" class="tab-pane fade {% if tab == 'testsuites' %}show active{% endif %}" id="testsuites" role="tabpanel">
        {% render_list contest.testsuite_set.all %}
    </div>
</div>
{% endblock content %}

{% block submenu %}
<div class="list-group mb-3">
    {% if perms.contests.change_contest %}
    <a href="{% url 'contests:contest-update' contest.id %}" class="list-group-item list-group-item-action"><i class="fa fa-edit fa-fw"></i> Редактировать раздел</a>
    {% endif %}
    {% if perms.contests.delete_contest %}
    <a href="{% url 'contests:contest-delete' contest.id %}" class="list-group-item list-group-item-action"><i class="fa fa-trash-o fa-fw"></i> Удалить раздел</a>
    {% endif %}
</div>
<div class="list-group mb-3">
    {% if perms.contests.add_problem %}
    <a href="{% url 'contests:problem-create' contest.id %}" class="list-group-item list-group-item-action"><i class="fa fa-plus fa-fw"></i> Добавить задачу</a>
    <a href="{% url 'contests:testsuite-create' contest.id %}" class="list-group-item list-group-item-action"><i class="fa fa-plus fa-fw"></i> Добавить набор тестов</a>
    {% endif %}
</div>
{% endblock submenu %}

{% block javascript %}
<script src="{% static 'MathJax/es5/tex-chtml.js' %}" type="text/javascript"></script>
<!--<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML"></script>-->
{% endblock javascript %}
