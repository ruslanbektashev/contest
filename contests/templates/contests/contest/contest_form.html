{% extends 'base_wide.html' %}
{% load views forms tutorial static %}

{% block title %}
Раздел
{% endblock title %}

{% block breadcrumbs %}
{% breadcrumb "Главная" 'contests:index' %}
{% breadcrumb course course %}
{% if contest %}
{% breadcrumb contest contest %}
{% breadcrumb "Редактирование" %}
{% else %}
{% breadcrumb "Новый раздел" %}
{% endif %}
{% endblock breadcrumbs %}

{% block content %}
<legend>{{ title }}</legend>
<form action="" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {% render_form_errors form %}
    {% if action == 'restore' or action == None %}
    {% render_field form.course %}
    {% endif %}
    {% with WIDGET_RENDER_TO_TEMPLATE="field.html" WIDGET_ERROR_CLASS="is-invalid" %}
    {% if action == 'restore' or action == None %}
    {{ form.media }}
    <div id="field_title">
    {% render_field form.title class+="form-control" %}
    </div>
    <div id="field_description" class="form-group">
        <label for="{{ field.id_for_label }}">
            {{ form.description.label }}{{ form.description.label_suffix }}
        </label>
        {% if form.description.errors %}
        <div class="form-group">
            <div class="alert alert-danger">
                {% for error in form.description.errors %}
                {{ error }}<br>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        <div class="input-group">
            {{ form.description }}
        </div>
    </div>
    {% endif %}
    {% if action == 'move' %}
    {% render_field form.course class+="form-control selectpicker" %}
    {% endif %}
    {% if action == 'move' or action == 'restore' or action == None %}
    <div id="field_number">
    {% render_field form.number class+="form-control" %}
    </div>
    {% endif %}
    {% endwith %}
    {% if action == 'add_files' or action == 'restore' or action == None %}
    {% with WIDGET_RENDER_TO_TEMPLATE="field_file.html" WIDGET_ERROR_CLASS="is-invalid" %}
    <div id="field_files">
    {% render_field form.files class+="custom-file-input" %}
    </div>
    {% endwith %}
    {% endif %}
    <div id="form_submit_button">
    {% render_submit_button value="Сохранить" %}
    </div>
</form>
{% endblock content %}

{% block javascript %}
<script src="{% static 'js/bs-custom-file-input.min.js' %}" type="text/javascript"></script>
<script type="text/javascript">
$(function () {
    bsCustomFileInput.init()
});
</script>
<script>
driver.defineSteps([
    {% if request.user.account.is_instructor %}
    {% if not request|have_passed_step:'field_title' %}
    {
        view: '{% tutorial_step_view request %}',
        step: 'field_title',
        element: '#field_title',
        popover: {
            title: " ",
            description: "Заголовок будет отображаться в списке разделов курса. " +
                "<br>Это поле обязательное и запонено по умолчанию. " +
                "Введите предпочитаемый заголовок раздела и нажмите &laquo;Далее&raquo;",
            position: 'bottom',
            className: 'driver-popover-md'
        }
    },
    {% endif %}
    {% if not request|have_passed_step:'field_description' %}
    {
        view: '{% tutorial_step_view request %}',
        step: 'field_description',
        element: '#field_description',
        popover: {
            title: " ",
            description: "В описание раздела можно добавлять изображения" +
                "",
            position: 'top'
        }
    },
    {% endif %}
    {% if not request|have_passed_step:'field_number' %}
    {
        view: '{% tutorial_step_view request %}',
        step: 'field_number',
        element: '#field_number',
        popover: {
            title: " ",
            description: "Номер раздела определяет порядок отображения столбцов с заданиями в таблице заданий курса. " +
                "<br>Это поле обязательное и заполнено по умолчанию. Номер раздела должен быть уникальным в данном курсе",
            position: 'bottom'
        }
    },
    {% endif %}
    {% if not request|have_passed_step:'field_files' %}
    {
        view: '{% tutorial_step_view request %}',
        step: 'field_files',
        element: '#field_files',
        popover: {
            title: " ",
            description: "Вы можете прикрепить к разделу файлы следующих типов: " +
                "<ul>" +
                "<li>текстовые .txt</li>" +
                "<li><strong>Microsoft Word</strong> .doc/.docx</li>" +
                "<li><strong>Excel</strong> .xls/.xlsx</li>" +
                "<li><strong>PowerPoint</strong> .ppt/.pptx</li>",
            position: 'bottom'
        }
    },
    {% endif %}
    {% if not request|have_passed_step:'form_submit_button' %}
    {
        view: '{% tutorial_step_view request %}',
        step: 'form_submit_button',
        element: '#form_submit_button',
        popover: {
            title: "Сохранение",
            description: "Когда заполните необходимые поля, нажмите на кнопку &laquo;Сохранить&raquo;",
            position: 'top'
        }
    },
    {% endif %}
    {% endif %}
])
</script>
{% endblock javascript %}
