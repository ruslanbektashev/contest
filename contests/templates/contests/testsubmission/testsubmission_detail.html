{% extends 'base.html' %}
{% load views contests markdown static %}

{% block title %}
Решение набора задач
{% endblock title %}

{% block breadcrumbs %}
{% breadcrumb "Главная" 'contests:index' %}
{% breadcrumb testsubmission.test.contest.course testsubmission.test.contest.course %}
{% breadcrumb testsubmission.test.contest testsubmission.test.contest %}
{% breadcrumb testsubmission.test testsubmission.test %}
{% breadcrumb testsubmission %}
{% endblock breadcrumbs %}

{% block content %}
<legend>{{ testsubmission }}</legend>

<table class="table table-sm">
    <tr><td class="text-right" style="width: 20%;">Автор</td><td><a href="{{ submission.owner.account.get_absolute_url }}">{{ testsubmission.owner.account }}</a></td></tr>
    <tr><td class="text-right" style="width: 20%;">Отправлена</td><td>{{ testsubmission.date_created }}</td></tr>
    <tr><td class="text-right" style="width: 20%;">Оценка</td><td>{{ testsubmission.score }}</td></tr>
</table>

<h5 class="mb-3">Ответы</h5>

{% for question, answer in questions %}
<div class="card mb-3" id="question_{{ question.number }}">
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
        #{{ question.number }}
        <span class="badge badge-pill badge-light`">Способ ответа: {{ question.get_type_display|lower }}</span>
        <span class="text-{% if answer == None %}warning{% elif answer.status == 1 %}dark{% elif answer.status == 2 %}success{% elif answer.status == 3 %}danger{% endif %}">
            {% if answer == None %}Не решено{% elif answer.status == 1 %}Не проверено{% elif answer.status == 2 %}Правильно{% elif answer.status == 3 %}Неправильно{% endif %}
        </span>
    </div>
    <div class="card-body">
        <p class="card-text">{{ question.text }}</p>
    </div>
    {% if question.type == 1 %}
    <ul class="list-group list-group-flush">
        <li class="list-group-item">
            <label class="card-text text-muted">
                Ответ:
                <div>
                    {{ answer.text }}
                </div>
            </label>
        </li>
    </ul>
    {% endif %}
    {% if question.type == 2 and question.option_set.all %}
    <div class="card ml-2 mb-2 mr-2">
        <ul class="list-group list-group-flush">
            {% for option in question.option_set.all %}
            <li class="list-group-item {% if option in answer.options.all %}text-primary{% endif %}">
                {% if option in answer.options.all %}<i class="fa fa-check-circle-o" aria-hidden="true"></i>{% endif %} {{ option.text }}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    {% if question.type == 3 and answer.file or answer and perms.contests.check_answer %}
    <div class="card-footer">
        <a href="{% url 'contests:answer-detail' answer.id %}" class="card-link" title="Просмотреть"> Просмотреть</a>
        {% if answer and perms.contests.check_answer %}
        <a href="{% url 'contests:answer-check' answer.id %}" class="card-link" title="Изменить статус"> Изменить статус</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% empty %}
<div>Нет задач.</div>
{% endfor %}
{% endblock content %}