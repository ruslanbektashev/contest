{% extends 'base.html' %}
{% load views accounts contests markdown static %}

{% block title %}
Задача
{% endblock title %}

{% block breadcrumbs %}
{% breadcrumb "Главная" 'contests:index' %}
{% breadcrumb problem.contest.course problem.contest.course %}
{% breadcrumb problem.contest problem.contest %}
{% breadcrumb problem %}
{% endblock breadcrumbs %}

{% block content %}
<legend>{{ problem }}</legend>
<ul class="nav nav-tabs mb-3" role="tablist">
    <li class="nav-item">
        <a aria-controls="description" aria-selected="{% if not tab or tab == 'description' %}true{% else %}false{% endif %}"
           class="nav-link {% if not tab or tab == 'description' %}active{% endif %}" data-toggle="tab"
           href="#description" id="description-tab" role="tab">Описание</a>
    </li>
    <li class="nav-item">
        <a aria-controls="submissions" aria-selected="{% if tab == 'submissions' %}true{% else %}false{% endif %}"
           class="nav-link {% if tab == 'submissions' %}active{% endif %}" data-toggle="tab" href="#submissions"
           id="submissions-tab" role="tab">Посылки</a>
    </li>
    {% if perms.contests.view_submission_pattern %}
    <li class="nav-item">
        <a aria-controls="submission_patterns" aria-selected="false" class="nav-link" data-toggle="tab" href="#submission_patterns" id="submission-patterns-tab"
           role="tab"><i class="fa fa-lock fa-fw"></i> Шаблоны посылок</a>
    </li>
    {% endif %}
    {% if perms.contests.view_iotest or perms.contests.view_uttest or perms.contests.view_fntest %}
    <li class="nav-item">
        <a aria-controls="tests" aria-selected="false" class="nav-link" data-toggle="tab" href="#tests" id="tests-tab"
           role="tab"><i class="fa fa-lock fa-fw"></i> Тесты</a>
    </li>
    {% endif %}
    <li class="nav-item">
        {% render_discussion_tab problem %}
    </li>
</ul>
<div class="tab-content">
    <div aria-labelledby="description-tab" class="tab-pane fade {% if not tab or tab == 'description' %}show active{% endif %}" id="description" role="tabpanel">
        <p>{{ problem.description|markdown|safe }}</p>
        <table class="table table-sm">
            <tr><td class="text-right">Сложность</td><td style="width: 20%;">{{ problem.get_difficulty_display }}</td></tr>
            <tr><td class="text-right">Язык</td><td style="width: 20%;">{{ problem.get_language_display }}</td></tr>
            {% if problem.compile_args %}
            <tr><td class="text-right">Параметры компиляции</td><td style="width: 20%;"><code>{{ problem.compile_args|default:"-" }}</code></td></tr>
            {% endif %}
            {% if problem.launch_args %}
            <tr><td class="text-right">Параметры запуска</td><td style="width: 20%;"><code>{{ problem.launch_args|default:"-" }}</code></td></tr>
            {% endif %}
            <tr><td class="text-right">Ограничение по времени</td><td style="width: 20%;">{{ problem.time_limit }} с</td></tr>
            <tr><td class="text-right">Ограничение по памяти</td><td style="width: 20%;">{{ problem.memory_limit|filesizeformat }}</td></tr>
            <tr><td class="text-right">Доступно для тестирования</td><td style="width: 20%;">{{ problem.is_testable|yesno:'да,нет' }}</td></tr>
            {% if latest_submission %}
            <tr>
                <td class="text-right">Мой результат</td>
                <td>
                    <a href="{{ latest_submission.get_absolute_url }}" class="badge badge-{{ latest_submission.status|colorize }}" title="{{ latest_submission.get_status_display }}">
                        {{ latest_submission.get_status_display }}
                    </a>
                </td>
            </tr>
            {% endif %}
        </table>
        {% render_attachment_list problem %}
        <hr/>
        <p>{{ problem.contest.description|markdown|safe }}</p>
        {% render_attachment_list problem.contest %}
    </div>
    <div aria-labelledby="submissions-tab" class="tab-pane fade {% if tab == 'submissions' %}show active{% endif %}" id="submissions" role="tabpanel">
        {% render_submission_table %}
    </div>
    {% if perms.contests.view_submission_pattern %}
    <div aria-labelledby="submission-patterns-tab" class="tab-pane fade" id="submission_patterns" role="tabpanel">
        <div class="alert alert-warning">Доступно только преподавателям</div>
        {% include 'list.html' with lst=problem.submission_patterns.all %}
    </div>
    {% endif %}
    {% if perms.contests.view_iotest or perms.contests.view_uttest or perms.contests.view_fntest %}
    <div aria-labelledby="tests-tab" class="tab-pane fade" id="tests" role="tabpanel">
        <div class="alert alert-warning">Доступно только преподавателям</div>
        {% include 'list.html' with lst=problem.iotest_set.all title="IO-тесты:" %}
        {% include 'list.html' with lst=problem.uttest_set.all title="UT-тесты:" %}
        {% include 'list.html' with lst=problem.fntest_set.all title="FN-тесты:" %}
    </div>
    {% endif %}
</div>
{% endblock content %}

{% block submenu %}
<div class="list-group mb-3">
    {% if perms.contests.change_problem %}
    <a href="{% url 'contests:problem-update' problem.id %}" class="list-group-item list-group-item-action"><i class="fa fa-edit fa-fw"></i> Редактировать задачу</a>
    {% endif %}
    {% if perms.contests.delete_problem %}
    <a href="{% url 'contests:problem-delete' problem.id %}" class="list-group-item list-group-item-action"><i class="fa fa-trash-o fa-fw"></i> Удалить задачу</a>
    {% endif %}
</div>
<div class="list-group mb-3">
    {% if perms.contests.add_submission_pattern %}
    <a href="{% url 'contests:submission-pattern-create' problem.id %}" class="list-group-item list-group-item-action"><i class="fa fa-plus fa-fw"></i> Добавить шаблон посылки</a>
    {% endif %}
</div>
<div class="list-group mb-3">
    {% if perms.contests.add_iotest %}
    <a href="{% url 'contests:iotest-create' problem.id %}" class="list-group-item list-group-item-action"><i class="fa fa-plus fa-fw"></i> Добавить IO-тест</a>
    {% endif %}
    {% if perms.contests.add_uttest %}
    <a href="{% url 'contests:uttest-create' problem.id %}" class="list-group-item list-group-item-action"><i class="fa fa-plus fa-fw"></i> Добавить UT-тест</a>
    {% endif %}
    {% if perms.contests.add_fntest %}
    <a href="{% url 'contests:fntest-create' problem.id %}" class="list-group-item list-group-item-action"><i class="fa fa-plus fa-fw"></i> Добавить FN-тест</a>
    {% endif %}
</div>
<div class="list-group mb-3">
    {% if perms.contests.add_submission %}
    <a href="{% url 'contests:submission-create' problem.id %}" class="btn btn-info btn-block"><i class="fa fa-file-code-o fa-fw"></i> Отправить решение</a>
    {% endif %}
</div>
{% endblock submenu %}

{% block javascript %}
<script src="{% static 'MathJax/es5/tex-chtml.js' %}" type="text/javascript"></script>
<!--<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML"></script>-->
{% endblock javascript %}
