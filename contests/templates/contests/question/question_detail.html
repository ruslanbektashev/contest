{% extends 'base.html' %}
{% load views markdown static %}

{% block title %}
Задача
{% endblock title %}

{% block breadcrumbs %}
{% breadcrumb "Главная" 'contests:index' %}
{% breadcrumb question.contest.course question.contest.course %}
{% breadcrumb question.contest question.contest %}
{% breadcrumb question %}
{% endblock breadcrumbs %}

{% block content %}

<legend>#{{ question.number }}. {{ question.title }} <small class="text-muted">способ ответа: {{ question.get_type_display|lower }}</small></legend>
<ul class="nav nav-tabs mb-3" role="tablist">
    <li class="nav-item">
        <a aria-controls="description" aria-selected="{% if not tab or tab == 'description' %}true{% else %}false{% endif %}"
           class="nav-link {% if not tab or tab == 'description' %}active{% endif %}" data-toggle="tab"
           href="#description" id="description-tab" role="tab">Описание</a>
    </li>
    <li class="nav-item">
        <a aria-controls="solution" aria-selected="{% if tab == 'solution' %}true{% else %}false{% endif %}"
           class="nav-link {% if tab == 'solution' %}active{% endif %}" data-toggle="tab" href="#solution"
           id="solution-tab" role="tab">Ответы</a>
    </li>
    <li class="nav-item">
        <a aria-controls="submissions" aria-selected="{% if tab == 'submissions' %}true{% else %}false{% endif %}"
           class="nav-link {% if tab == 'submissions' %}active{% endif %}" data-toggle="tab" href="#submissions"
           id="submissions-tab" role="tab">Посылки</a>
    </li>
</ul>
<div class="tab-content">
    <div aria-labelledby="description-tab" class="tab-pane fade {% if not tab or tab == 'description' %}show active{% endif %}" id="description" role="tabpanel">
        {% with options=question.option_set.all%}
        <p>{{ question.description }}</p>

        {% if options %}
        <h6 class="mb-3">Варианты ответа</h6>
        <ul class="list-group mb-3">
            {% for option in options %}
            <li class="list-group-item d-flex justify-content-between align-items-center">{{ option.text }}
                <span>
                    {% if perms.contests.update_option %}
                    <a href="{% url 'contests:option-update' option.id %}" class="btn btn-light btn-sm border">Изменить</a>
                    {% endif %}
                    {% if perms.contests.delete_option %}
                    <a href="{% url 'contests:option-delete' option.id %}" class="btn btn-light btn-sm border ml-1">Удалить</a>
                    {% endif %}
                </span>
            </li>
            {% endfor %}
        </ul>
        {% elif question.type == 2 %}
        <div class="alert alert-warning">
            Добавьте варианты ответов.
        </div>
        {% endif %}
        {% endwith %}
    </div>
    <div aria-labelledby="solution-tab" class="tab-pane fade {% if tab == 'solution' %}show active{% endif %}" id="solution" role="tabpanel">
        {% with options=question.option_set.all%}
        <p>{{ question.description }}</p>

        {% if options %}
        <h6 class="mb-3">Варианты ответа</h6>
        <ul class="list-group mb-3">
            {% for option in options %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span class="{% if option.is_right %}text-success{% endif %}">
                    {% if option.is_right %}<i class="fa fa-check-circle-o" aria-hidden="true"></i>{% endif %}
                    {{ option.text }}
                </span>
                <span>
                    {% if perms.contests.update_option %}
                    <a href="{% url 'contests:option-update' option.id %}" class="btn btn-light btn-sm border">Изменить</a>
                    {% endif %}
                    {% if perms.contests.delete_option %}
                    <a href="{% url 'contests:option-delete' option.id %}" class="btn btn-light btn-sm border ml-1">Удалить</a>
                    {% endif %}
                </span>
            </li>
            {% endfor %}
        </ul>
        {% elif question.type == 2 %}
        <div class="alert alert-warning">
            Добавьте варианты ответов.
        </div>
        {% endif %}
        {% endwith %}
    </div>
    <div aria-labelledby="submissions-tab" class="tab-pane fade {% if tab == 'submissions' %}show active{% endif %}" id="submissions" role="tabpanel">
        {% if answers %}
        {% load views contests %}
        <div class="table-responsive">
            <table id="p" class="table table-bordered table-sm">
                <thead>
                    <tr>
                        <th class="text-center" style="width: 18%;">Дата</th>
                        {% if perms.contests.view_testsubmission_list %}
                        <th>Студент</th>
                        {% endif %}
                        <th class="text-center" style="width: 8%;">Статус</th>
                        <th class="text-center" style="width: 8%;">Оценка</th>
                    </tr>
                </thead>
                <tbody>
                    {% now 'Y' as current_year %}
                    {% for answer in answers %}
                    <tr>
                        <td class="text-center">{% if answer.date_created|date:'Y' == current_year %}{{ answer.date_created|date:'d b в H:i' }}{% else %}{{ answer.date_created|date:'d b y г. в H:i' }}{% endif %}</td>
                        {% if perms.contests.view_submission_list %}
                        <td>
                            <a href="{{ answer.owner.account.get_absolute_url }}">
                                {{ answer.owner.account }}
                            </a>
                        </td>
                        {% endif %}
                        <td class="text-center">
                            <a href="{{ answer.get_absolute_url }}" class="badge badge-secondary">
                                {{ answer.get_status_display|lower }}
                            </a>
                        </td>
                        <td class="text-center">
                            {% if answer.score %}
                            <a href="{{ answer.get_absolute_url }}" class="badge badge-secondary">
                                {{ answer.score }}
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">Нет посылок.</div>
        {% endif %}
    </div>
</div>

{% endblock content %}

{% block submenu %}
<div class="list-group mb-3">
    {% if perms.contests.change_question %}
    <a href="{% url 'contests:question-update' question.id %}" class="list-group-item list-group-item-action"><i class="fa fa-edit fa-fw"></i> Редактировать задачу</a>
    {% endif %}
    {% if perms.contests.delete_question %}
    <a href="{% url 'contests:question-delete' question.id %}" class="list-group-item list-group-item-action"><i class="fa fa-trash fa-fw"></i> Удалить задачу</a>
    {% endif %}
</div>
{% if perms.contests.add_option and question.type == 2 %}
<div class="list-group mb-3">
    <a href="{% url 'contests:option-create' question.id %}" class="list-group-item list-group-item-action"><i class="fa fa-plus fa-fw"></i> Добавить вариант ответа</a>
</div>
{% endif %}
{% if perms.contests.add_answer %}
<div class="list-group mb-3">
    <a href="{% url 'contests:answer-create' question.id %}" class="btn btn-info btn-block">
        <i class="fa fa-check-square-o fa-fw"></i> Решить задачу
    </a>
</div>
{% endif %}
{% endblock submenu %}

{% block javascript %}
<script src="{% static 'MathJax/es5/tex-chtml.js' %}" type="text/javascript"></script>
{% endblock javascript %}
