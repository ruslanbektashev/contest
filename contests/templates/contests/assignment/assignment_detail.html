{% extends 'base.html' %}
{% load views accounts contests %}

{% block title %}
Задание
{% endblock title %}

{% block breadcrumbs %}
{% breadcrumb "Главная" 'contests:index' %}
{% if perms.contests.view_assignment_table %}
{% breadcrumb assignment.problem.contest.course assignment.problem.contest.course %}
{% breadcrumb "Задания" 'contests:assignment-table' assignment.problem.contest.course.id %}
{% else %}
{% breadcrumb "Мои задания" 'contests:assignment-list' %}
{% endif %}
{% breadcrumb assignment %}
{% endblock breadcrumbs %}

{% block content %}
<legend>{{ assignment }}</legend>
<a class="btn btn-light btn-block border mb-3" href="{% url 'contests:assignment-discussion' assignment.id %}">
    {% unread_comments_count request.user.account assignment as ucc %}
    <i class="fa fa-comments fa-fw"></i> Обсуждение{% if ucc > 0 %} <span id="unread_comments_count" class="badge badge-pill badge-secondary align-middle">{{ ucc }}</span>{% endif %}
</a>
<table class="table table-sm">
    <tr><td class="text-right" style="width: 20%;">Студент</td><td><a href="{{ assignment.user.account.get_absolute_url }}">{{ assignment.user.account }}</a></td></tr>
    {% if assignment.test %}
    <tr><td class="text-right" style="width: 20%;">Тест</td><td><a href="{{ assignment.test.get_absolute_url }}">{{ assignment.test }}</a></td></tr>
    {% else %}
    <tr><td class="text-right" style="width: 20%;">Задача</td><td><a href="{{ assignment.problem.get_absolute_url }}">{{ assignment.problem }}</a></td></tr>
    {% endif %}
    <tr>
        <td class="text-right" style="width: 20%;">Оценка</td>
        <td>
            <span class="numtus status-{{ assignment.score|colorize }}">{{ assignment.score|default:'-' }}</span>{% if perms.contests.change_assignment %} {% if assignment.score_max < 5 %}/ {{ assignment.score_max }}{% endif %}{% if assignment.score_is_locked %} <span class="numtus status-warning" title="Оценка заблокирована и не может быть изменена системой автоматической проверки посылок"><i class="fa fa-lock"></i></span>{% endif %}{% endif %}
        </td>
    </tr>
    <tr><td class="text-right" style="width: 20%;">Назначено</td><td>{{ assignment.date_created }}</td></tr>
    <tr><td class="text-right" style="width: 20%;">Обновлено</td><td>{{ assignment.date_updated }}</td></tr>
    <tr><td class="text-right" style="width: 20%;">Посылок</td><td>{{ assignment.get_submissions.count }} / {{ assignment.submission_limit }}</td></tr>
</table>
{% if perms.contests.view_assignment_table and assignment.remark %}
<div class="alert alert-warning" title="Отображается только преподавателям"><i class="fa fa-lock fa-fw"></i>Пометка для преподавателей: {{ assignment.remark }}</div>
{% endif %}
<div class="col-xs-12 col-md-6 mx-auto">
    {% include 'contests/submission/submission_table.html' %}
</div>
{% endblock content %}

{% block submenu %}
<div class="list-group mb-3">
    {% if perms.contests.change_assignment %}
    <a href="{% url 'contests:assignment-update' assignment.id %}" class="list-group-item list-group-item-action"><i class="fa fa-edit fa-fw"></i> Редактировать задание</a>
    {% endif %}
    {% if perms.contests.delete_assignment %}
    <a href="{% url 'contests:assignment-delete' assignment.id %}" class="list-group-item list-group-item-action"><i class="fa fa-trash-o fa-fw"></i> Удалить задание</a>
    {% endif %}
    {% if request.user == assignment.user %}
    {% if not assignment.test %}
    {% if assignment.submission_limit > assignment.get_submissions.count %}
    <a href="{% url 'contests:submission-create' assignment.problem.id %}" class="btn btn-info btn-block"><i class="fa fa-file-code-o fa-fw"></i> Отправить решение</a>
    {% else %}
    <button class="btn btn-warning btn-block">Все попытки потрачены</button>
    {% endif %}
    {% else %}
    <a href="{% url 'contests:testsubmission-create' assignment.test.id %}" class="btn btn-info btn-block"><i class="fa fa-file-code-o fa-fw"></i> Пройти тест</a>
    {% endif %}
    {% endif %}
</div>
{% endblock submenu %}
